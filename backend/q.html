<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudentMarket - Kết quả tìm kiếm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            box-sizing: border-box;
        }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .price-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .condition-badge {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body class="bg-gray-50" x-data="productGrid()">
    <!-- Header với Search -->
    <div class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-white text-lg"></i>
                    </div>
                    <h1 class="text-xl font-bold text-gray-900">StudentMarket</h1>
                </div>

                <!-- Search Bar -->
                <div class="flex-1 max-w-2xl mx-8">
                    <div class="relative">
                        <input 
                            type="text" 
                            x-model="searchQuery"
                            @input="debounceSearch"
                            placeholder="Tìm kiếm sản phẩm, thương hiệu..."
                            class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        
                        <!-- Search Suggestions -->
                        <div x-show="showSuggestions && searchSuggestions.length > 0" 
                             x-transition
                             class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg mt-1 z-50">
                            <template x-for="suggestion in searchSuggestions" :key="suggestion">
                                <div @click="selectSuggestion(suggestion)" 
                                     class="px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0">
                                    <i class="fas fa-search text-gray-400 mr-3"></i>
                                    <span x-text="suggestion"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- User Actions -->
                <div class="flex items-center space-x-4">
                    <button class="relative p-2 text-gray-600 hover:text-blue-600">
                        <i class="fas fa-heart text-xl"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Đăng tin
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="flex gap-6">
            <!-- Sidebar Filters -->
            <div class="w-80 flex-shrink-0">
                <div class="bg-white rounded-xl shadow-sm p-6 sticky top-24">
                    <!-- Filter Header -->
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-semibold text-gray-900">Bộ lọc</h2>
                        <button @click="resetFilters" class="text-sm text-blue-600 hover:text-blue-800">
                            <i class="fas fa-undo mr-1"></i>Đặt lại
                        </button>
                    </div>

                    <!-- Categories -->
                    <div class="mb-6">
                        <h3 class="font-medium text-gray-900 mb-3">Danh mục</h3>
                        <div class="space-y-2">
                            <template x-for="category in categories" :key="category.id">
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           :value="category.id"
                                           x-model="selectedCategories"
                                           @change="applyFilters"
                                           class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3">
                                    <span class="text-sm text-gray-700" x-text="category.name"></span>
                                    <span class="ml-auto text-xs text-gray-500" x-text="'(' + category.count + ')'"></span>
                                </label>
                            </template>
                        </div>
                    </div>

                    <!-- Price Range -->
                    <div class="mb-6">
                        <h3 class="font-medium text-gray-900 mb-3">Khoảng giá</h3>
                        <div class="space-y-2">
                            <template x-for="range in priceRanges" :key="range.id">
                                <label class="flex items-center">
                                    <input type="radio" 
                                           :value="range.id"
                                           x-model="selectedPriceRange"
                                           @change="applyFilters"
                                           name="priceRange"
                                           class="text-blue-600 focus:ring-blue-500 mr-3">
                                    <span class="text-sm text-gray-700" x-text="range.label"></span>
                                </label>
                            </template>
                        </div>
                    </div>

                    <!-- Condition -->
                    <div class="mb-6">
                        <h3 class="font-medium text-gray-900 mb-3">Tình trạng</h3>
                        <div class="space-y-2">
                            <template x-for="condition in conditions" :key="condition.value">
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           :value="condition.value"
                                           x-model="selectedConditions"
                                           @change="applyFilters"
                                           class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3">
                                    <span class="text-sm text-gray-700" x-text="condition.label"></span>
                                </label>
                            </template>
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="mb-6">
                        <h3 class="font-medium text-gray-900 mb-3">Khu vực</h3>
                        <select x-model="selectedLocation" @change="applyFilters" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Tất cả khu vực</option>
                            <template x-for="location in locations" :key="location.value">
                                <option :value="location.value" x-text="location.label"></option>
                            </template>
                        </select>
                    </div>

                    <!-- Additional Filters -->
                    <div class="space-y-3">
                        <label class="flex items-center">
                            <input type="checkbox" x-model="filters.negotiable" @change="applyFilters"
                                   class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3">
                            <span class="text-sm text-gray-700">Có thể thương lượng</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" x-model="filters.hasImages" @change="applyFilters"
                                   class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3">
                            <span class="text-sm text-gray-700">Có ảnh thật</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" x-model="filters.verified" @change="applyFilters"
                                   class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3">
                            <span class="text-sm text-gray-700">Người bán uy tín</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-1">
                <!-- Results Header -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <h2 class="text-lg font-semibold text-gray-900">
                                <span x-text="totalResults"></span> sản phẩm
                                <span x-show="searchQuery" class="text-blue-600">
                                    cho "<span x-text="searchQuery"></span>"
                                </span>
                            </h2>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">Sắp xếp:</span>
                                <select x-model="sortBy" @change="applyFilters" 
                                        class="border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500">
                                    <option value="newest">Mới nhất</option>
                                    <option value="price_low">Giá thấp đến cao</option>
                                    <option value="price_high">Giá cao đến thấp</option>
                                    <option value="popular">Phổ biến</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- View Toggle -->
                        <div class="flex items-center space-x-2">
                            <button @click="viewMode = 'grid'" 
                                    :class="viewMode === 'grid' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'"
                                    class="p-2 rounded-lg transition-colors">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button @click="viewMode = 'list'" 
                                    :class="viewMode === 'list' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'"
                                    class="p-2 rounded-lg transition-colors">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div x-show="loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <template x-for="i in 8" :key="i">
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                            <div class="skeleton h-48"></div>
                            <div class="p-4">
                                <div class="skeleton h-4 mb-2 rounded"></div>
                                <div class="skeleton h-4 mb-3 w-3/4 rounded"></div>
                                <div class="skeleton h-6 w-1/2 rounded"></div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Products Grid -->
                <div x-show="!loading" 
                     :class="viewMode === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6' : 'space-y-4'">
                    <template x-for="product in filteredProducts" :key="product.id">
                        <!-- Grid View -->
                        <div x-show="viewMode === 'grid'" 
                             class="bg-white rounded-xl shadow-sm overflow-hidden product-card cursor-pointer"
                             @click="viewProduct(product)">
                            <!-- Product Image -->
                            <div class="relative h-48 bg-gray-100">
                                <img :src="product.image" :alt="product.title" 
                                     class="w-full h-full object-cover">
                                
                                <!-- Badges -->
                                <div class="absolute top-3 left-3">
                                    <span x-show="product.is_featured" 
                                          class="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full font-medium">
                                        <i class="fas fa-star mr-1"></i>Nổi bật
                                    </span>
                                </div>
                                
                                <div class="absolute top-3 right-3 space-y-2">
                                    <button @click.stop="toggleFavorite(product)" 
                                            :class="product.is_favorited ? 'text-red-500' : 'text-gray-400'"
                                            class="bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-md hover:scale-110 transition-transform">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>

                                <div class="absolute bottom-3 left-3">
                                    <span :class="getConditionColor(product.condition)" 
                                          class="condition-badge text-xs px-2 py-1 rounded-full font-medium">
                                        <span x-text="getConditionText(product.condition)"></span>
                                    </span>
                                </div>
                            </div>

                            <!-- Product Info -->
                            <div class="p-4">
                                <h3 class="font-semibold text-gray-900 mb-2 line-clamp-2" x-text="product.title"></h3>
                                
                                <!-- Price -->
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <span class="text-xl font-bold text-blue-600" x-text="formatPrice(product.price)"></span>
                                        <span x-show="product.original_price" 
                                              class="text-sm text-gray-500 line-through ml-2" 
                                              x-text="formatPrice(product.original_price)"></span>
                                    </div>
                                    <span x-show="product.is_negotiable" 
                                          class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">
                                        Có TL
                                    </span>
                                </div>

                                <!-- Location & Time -->
                                <div class="flex items-center justify-between text-sm text-gray-500">
                                    <div class="flex items-center">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        <span x-text="product.location"></span>
                                    </div>
                                    <span x-text="formatTime(product.created_at)"></span>
                                </div>

                                <!-- Seller Info -->
                                <div class="flex items-center mt-3 pt-3 border-t border-gray-100">
                                    <img :src="product.seller.avatar" :alt="product.seller.name"
                                         class="w-6 h-6 rounded-full mr-2">
                                    <span class="text-sm text-gray-700 flex-1" x-text="product.seller.name"></span>
                                    <div class="flex items-center">
                                        <i class="fas fa-star text-yellow-400 text-xs mr-1"></i>
                                        <span class="text-xs text-gray-600" x-text="product.seller.rating"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- List View -->
                        <div x-show="viewMode === 'list'" 
                             class="bg-white rounded-xl shadow-sm overflow-hidden product-card cursor-pointer"
                             @click="viewProduct(product)">
                            <div class="flex">
                                <!-- Image -->
                                <div class="w-32 h-32 flex-shrink-0 bg-gray-100">
                                    <img :src="product.image" :alt="product.title" 
                                         class="w-full h-full object-cover">
                                </div>
                                
                                <!-- Content -->
                                <div class="flex-1 p-4">
                                    <div class="flex justify-between">
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 mb-2" x-text="product.title"></h3>
                                            <p class="text-sm text-gray-600 mb-2 line-clamp-2" x-text="product.description"></p>
                                            
                                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                                <span><i class="fas fa-map-marker-alt mr-1"></i><span x-text="product.location"></span></span>
                                                <span x-text="formatTime(product.created_at)"></span>
                                                <span :class="getConditionColor(product.condition)" 
                                                      class="px-2 py-1 rounded-full text-xs">
                                                    <span x-text="getConditionText(product.condition)"></span>
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="text-right ml-4">
                                            <div class="text-xl font-bold text-blue-600 mb-2" x-text="formatPrice(product.price)"></div>
                                            <div class="flex items-center space-x-2">
                                                <button @click.stop="toggleFavorite(product)" 
                                                        :class="product.is_favorited ? 'text-red-500' : 'text-gray-400'"
                                                        class="hover:scale-110 transition-transform">
                                                    <i class="fas fa-heart"></i>
                                                </button>
                                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                                    Xem chi tiết
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Empty State -->
                <div x-show="!loading && filteredProducts.length === 0" 
                     class="text-center py-12">
                    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-search text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Không tìm thấy sản phẩm</h3>
                    <p class="text-gray-600 mb-4">Thử thay đổi từ khóa tìm kiếm hoặc bộ lọc</p>
                    <button @click="resetFilters" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Đặt lại bộ lọc
                    </button>
                </div>

                <!-- Pagination -->
                <div x-show="!loading && filteredProducts.length > 0" 
                     class="flex items-center justify-center mt-8 space-x-2">
                    <button @click="changePage(currentPage - 1)" 
                            :disabled="currentPage === 1"
                            :class="currentPage === 1 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100'"
                            class="px-3 py-2 border border-gray-300 rounded-lg">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <template x-for="page in visiblePages" :key="page">
                        <button @click="changePage(page)" 
                                :class="page === currentPage ? 'bg-blue-600 text-white' : 'hover:bg-gray-100'"
                                class="px-3 py-2 border border-gray-300 rounded-lg"
                                x-text="page">
                        </button>
                    </template>
                    
                    <button @click="changePage(currentPage + 1)" 
                            :disabled="currentPage === totalPages"
                            :class="currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-100'"
                            class="px-3 py-2 border border-gray-300 rounded-lg">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function productGrid() {
            return {
                // Search & Filters
                searchQuery: '',
                searchSuggestions: [],
                showSuggestions: false,
                selectedCategories: [],
                selectedPriceRange: '',
                selectedConditions: [],
                selectedLocation: '',
                sortBy: 'newest',
                viewMode: 'grid',
                
                // Filter Options
                categories: [
                    { id: 1, name: 'Điện tử', count: 234 },
                    { id: 2, name: 'Sách vở', count: 189 },
                    { id: 3, name: 'Thời trang', count: 156 },
                    { id: 4, name: 'Đồ dùng', count: 98 },
                    { id: 5, name: 'Xe cộ', count: 67 }
                ],
                
                priceRanges: [
                    { id: 1, label: 'Dưới 500K', min: 0, max: 500000 },
                    { id: 2, label: '500K - 2M', min: 500000, max: 2000000 },
                    { id: 3, label: '2M - 10M', min: 2000000, max: 10000000 },
                    { id: 4, label: 'Trên 10M', min: 10000000, max: null }
                ],
                
                conditions: [
                    { value: 'new', label: 'Mới 100%' },
                    { value: 'like_new', label: 'Như mới (95%)' },
                    { value: 'good', label: 'Tốt (80%)' },
                    { value: 'fair', label: 'Khá (60%)' }
                ],
                
                locations: [
                    { value: 'district1', label: 'Quận 1' },
                    { value: 'district3', label: 'Quận 3' },
                    { value: 'district7', label: 'Quận 7' },
                    { value: 'thu-duc', label: 'Thủ Đức' },
                    { value: 'binh-thanh', label: 'Bình Thạnh' }
                ],
                
                filters: {
                    negotiable: false,
                    hasImages: false,
                    verified: false
                },
                
                // Data & State
                products: [],
                filteredProducts: [],
                loading: true,
                totalResults: 0,
                currentPage: 1,
                totalPages: 1,
                perPage: 20,
                
                // Computed
                get visiblePages() {
                    const pages = [];
                    const start = Math.max(1, this.currentPage - 2);
                    const end = Math.min(this.totalPages, this.currentPage + 2);
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    return pages;
                },
                
                init() {
                    this.loadProducts();
                    this.setupSearchSuggestions();
                },
                
                loadProducts() {
                    this.loading = true;
                    
                    // Simulate API call
                    setTimeout(() => {
                        this.products = this.generateSampleProducts();
                        this.applyFilters();
                        this.loading = false;
                    }, 1000);
                },
                
                generateSampleProducts() {
                    const sampleProducts = [];
                    const titles = [
                        'iPhone 13 Pro Max 256GB', 'MacBook Air M2', 'Samsung Galaxy S23', 
                        'iPad Pro 11 inch', 'AirPods Pro 2', 'Sách Toán cao cấp',
                        'Áo hoodie Uniqlo', 'Giày Nike Air Force', 'Bàn học gỗ',
                        'Xe đạp thể thao', 'Laptop Dell XPS', 'Tai nghe Sony'
                    ];
                    
                    for (let i = 1; i <= 50; i++) {
                        sampleProducts.push({
                            id: i,
                            title: titles[Math.floor(Math.random() * titles.length)] + ` #${i}`,
                            description: 'Sản phẩm chất lượng cao, còn mới, sử dụng ít...',
                            price: Math.floor(Math.random() * 20000000) + 500000,
                            original_price: Math.random() > 0.7 ? Math.floor(Math.random() * 25000000) + 1000000 : null,
                            condition: ['new', 'like_new', 'good', 'fair'][Math.floor(Math.random() * 4)],
                            is_negotiable: Math.random() > 0.5,
                            is_featured: Math.random() > 0.8,
                            is_favorited: Math.random() > 0.7,
                            location: ['Quận 1', 'Quận 3', 'Quận 7', 'Thủ Đức'][Math.floor(Math.random() * 4)],
                            image: `https://picsum.photos/300/200?random=${i}`,
                            created_at: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000),
                            category_id: Math.floor(Math.random() * 5) + 1,
                            seller: {
                                name: `Người bán ${i}`,
                                avatar: `https://ui-avatars.com/api/?name=User${i}&background=random`,
                                rating: (Math.random() * 2 + 3).toFixed(1)
                            }
                        });
                    }
                    
                    return sampleProducts;
                },
                
                setupSearchSuggestions() {
                    this.searchSuggestions = [
                        'iPhone 13', 'MacBook', 'Samsung Galaxy', 'iPad',
                        'Sách giáo khoa', 'Áo hoodie', 'Giày Nike', 'Laptop Dell'
                    ];
                },
                
                debounceSearch() {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => {
                        this.showSuggestions = this.searchQuery.length > 0;
                        this.applyFilters();
                    }, 300);
                },
                
                selectSuggestion(suggestion) {
                    this.searchQuery = suggestion;
                    this.showSuggestions = false;
                    this.applyFilters();
                },
                
                applyFilters() {
                    let filtered = [...this.products];
                    
                    // Search filter
                    if (this.searchQuery) {
                        filtered = filtered.filter(product => 
                            product.title.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                            product.description.toLowerCase().includes(this.searchQuery.toLowerCase())
                        );
                    }
                    
                    // Category filter
                    if (this.selectedCategories.length > 0) {
                        filtered = filtered.filter(product => 
                            this.selectedCategories.includes(product.category_id)
                        );
                    }
                    
                    // Price filter
                    if (this.selectedPriceRange) {
                        const range = this.priceRanges.find(r => r.id == this.selectedPriceRange);
                        if (range) {
                            filtered = filtered.filter(product => {
                                if (range.max) {
                                    return product.price >= range.min && product.price <= range.max;
                                } else {
                                    return product.price >= range.min;
                                }
                            });
                        }
                    }
                    
                    // Condition filter
                    if (this.selectedConditions.length > 0) {
                        filtered = filtered.filter(product => 
                            this.selectedConditions.includes(product.condition)
                        );
                    }
                    
                    // Location filter
                    if (this.selectedLocation) {
                        filtered = filtered.filter(product => 
                            product.location.includes(this.selectedLocation)
                        );
                    }
                    
                    // Additional filters
                    if (this.filters.negotiable) {
                        filtered = filtered.filter(product => product.is_negotiable);
                    }
                    
                    if (this.filters.hasImages) {
                        filtered = filtered.filter(product => product.image);
                    }
                    
                    // Sort
                    switch (this.sortBy) {
                        case 'price_low':
                            filtered.sort((a, b) => a.price - b.price);
                            break;
                        case 'price_high':
                            filtered.sort((a, b) => b.price - a.price);
                            break;
                        case 'popular':
                            filtered.sort((a, b) => b.view_count - a.view_count);
                            break;
                        default: // newest
                            filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    }
                    
                    this.totalResults = filtered.length;
                    this.totalPages = Math.ceil(filtered.length / this.perPage);
                    
                    // Pagination
                    const start = (this.currentPage - 1) * this.perPage;
                    const end = start + this.perPage;
                    this.filteredProducts = filtered.slice(start, end);
                },
                
                resetFilters() {
                    this.searchQuery = '';
                    this.selectedCategories = [];
                    this.selectedPriceRange = '';
                    this.selectedConditions = [];
                    this.selectedLocation = '';
                    this.sortBy = 'newest';
                    this.filters = {
                        negotiable: false,
                        hasImages: false,
                        verified: false
                    };
                    this.currentPage = 1;
                    this.applyFilters();
                },
                
                changePage(page) {
                    if (page >= 1 && page <= this.totalPages) {
                        this.currentPage = page;
                        this.applyFilters();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                toggleFavorite(product) {
                    product.is_favorited = !product.is_favorited;
                    // In real app: API call to toggle favorite
                },
                
                viewProduct(product) {
                    // In real app: navigate to product detail page
                    console.log('Viewing product:', product);
                },
                
                // Helper methods
                formatPrice(price) {
                    return new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(price);
                },
                
                formatTime(date) {
                    const now = new Date();
                    const diff = now - new Date(date);
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    
                    if (days === 0) return 'Hôm nay';
                    if (days === 1) return 'Hôm qua';
                    if (days < 7) return `${days} ngày trước`;
                    return new Date(date).toLocaleDateString('vi-VN');
                },
                
                getConditionText(condition) {
                    const map = {
                        'new': 'Mới 100%',
                        'like_new': 'Như mới',
                        'good': 'Tốt',
                        'fair': 'Khá'
                    };
                    return map[condition] || condition;
                },
                
                getConditionColor(condition) {
                    const map = {
                        'new': 'bg-green-100 text-green-700',
                        'like_new': 'bg-blue-100 text-blue-700',
                        'good': 'bg-yellow-100 text-yellow-700',
                        'fair': 'bg-orange-100 text-orange-700'
                    };
                    return map[condition] || 'bg-gray-100 text-gray-700';
                }
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98532b9b94ca9cf9',t:'MTc1ODg5Mzk5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>



